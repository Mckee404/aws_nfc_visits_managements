{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.202.0"},"children":{"IoTCoreStack":{"id":"IoTCoreStack","path":"IoTCoreStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.202.0"},"children":{"EventDataTable":{"id":"EventDataTable","path":"IoTCoreStack/EventDataTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.202.0","metadata":[{"tableName":"*","partitionKey":{"name":"*","type":"S"},"sortKey":{"name":"*","type":"S"},"billingMode":"PAY_PER_REQUEST","removalPolicy":"destroy"},{"addGlobalSecondaryIndex":[{"indexName":"*","partitionKey":{"name":"*","type":"S"},"projectionType":"ALL"}]},{"addGlobalSecondaryIndex":[{"indexName":"*","partitionKey":{"name":"*","type":"S"},"projectionType":"ALL"}]}]},"children":{"Resource":{"id":"Resource","path":"IoTCoreStack/EventDataTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"partitionKey","attributeType":"S"},{"attributeName":"sortKey","attributeType":"S"},{"attributeName":"GSI_1_PK","attributeType":"S"},{"attributeName":"GSI_1_SK","attributeType":"S"},{"attributeName":"GSI_2_PK","attributeType":"S"},{"attributeName":"GSI_2_SK","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","globalSecondaryIndexes":[{"indexName":"GSI1-GenericQueries","keySchema":[{"attributeName":"GSI_1_PK","keyType":"HASH"},{"attributeName":"GSI_1_SK","keyType":"RANGE"}],"projection":{"projectionType":"ALL"}},{"indexName":"VisitRecordsByDateAndTimestamp","keySchema":[{"attributeName":"GSI_2_PK","keyType":"HASH"},{"attributeName":"GSI_2_SK","keyType":"RANGE"}],"projection":{"projectionType":"ALL"}}],"keySchema":[{"attributeName":"partitionKey","keyType":"HASH"},{"attributeName":"sortKey","keyType":"RANGE"}],"tableName":"EventData","tags":[{"key":"Environment","value":"Development"},{"key":"Project","value":"NFCVisitManagement"}]}}},"ScalingRole":{"id":"ScalingRole","path":"IoTCoreStack/EventDataTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.202.0","metadata":["*"]}}}},"NFCIoTPolicy":{"id":"NFCIoTPolicy","path":"IoTCoreStack/NFCIoTPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iot.CfnPolicy","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IoT::Policy","aws:cdk:cloudformation:props":{"tags":[{"key":"Environment","value":"Development"},{"key":"Project","value":"NFCVisitManagement"}],"policyDocument":{"Version":"2012-10-17","Statement":[{"Effect":"Allow","Action":["iot:Connect"],"Resource":["arn:aws:iot:ap-northeast-1:514760581321:client/nfc-reader-*"]},{"Effect":"Allow","Action":["iot:Publish"],"Resource":["arn:aws:iot:ap-northeast-1:514760581321:topic/nfc/visits/*"]},{"Effect":"Allow","Action":["iot:Subscribe"],"Resource":["arn:aws:iot:ap-northeast-1:514760581321:topicfilter/nfc/commands/*"]},{"Effect":"Allow","Action":["iot:Receive"],"Resource":["arn:aws:iot:ap-northeast-1:514760581321:topic/nfc/commands/*"]}]},"policyName":"NFCDevicePolicy"}}},"CertHandlerLambda":{"id":"CertHandlerLambda","path":"IoTCoreStack/CertHandlerLambda","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.DockerImageFunction","version":"2.202.0","metadata":[{"code":"*","timeout":"*","memorySize":"*","environment":"*","architecture":"*"},{"code":"*","timeout":"*","memorySize":"*","environment":"*","architecture":"*"}]},"children":{"ServiceRole":{"id":"ServiceRole","path":"IoTCoreStack/CertHandlerLambda/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.202.0","metadata":[{"assumedBy":{"principalAccount":"*","assumeRoleAction":"*"},"managedPolicies":[{"managedPolicyArn":"*"}]},{"addToPrincipalPolicy":[{}]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]}]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"IoTCoreStack/CertHandlerLambda/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.202.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"IoTCoreStack/CertHandlerLambda/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}],"tags":[{"key":"Environment","value":"Development"},{"key":"Project","value":"NFCVisitManagement"}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"IoTCoreStack/CertHandlerLambda/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.202.0","metadata":["*",{"attachToRole":["*"]},{"attachToRole":["*"]},{"addStatements":[{}]}]},"children":{"Resource":{"id":"Resource","path":"IoTCoreStack/CertHandlerLambda/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["iot:AttachPolicy","iot:AttachThingPrincipal","iot:CreateKeysAndCertificate","iot:CreatePolicy","iot:DescribeCertificate","iot:ListPolicies","iot:ListThings","iot:UpdateCertificate"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"CertHandlerLambdaServiceRoleDefaultPolicy6AFE3F98","roles":[{"Ref":"CertHandlerLambdaServiceRoleA08797B0"}]}}}}}}},"AssetImage":{"id":"AssetImage","path":"IoTCoreStack/CertHandlerLambda/AssetImage","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr_assets.DockerImageAsset","version":"2.202.0"},"children":{"Staging":{"id":"Staging","path":"IoTCoreStack/CertHandlerLambda/AssetImage/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.202.0"}},"Repository":{"id":"Repository","path":"IoTCoreStack/CertHandlerLambda/AssetImage/Repository","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.RepositoryBase","version":"2.202.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"IoTCoreStack/CertHandlerLambda/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["arm64"],"code":{"imageUri":{"Fn::Sub":"514760581321.dkr.ecr.ap-northeast-1.${AWS::URLSuffix}/cdk-hnb659fds-container-assets-514760581321-ap-northeast-1:3b02f9a2613eb27ee55862ecbe5ea7a7fa1acca1f1b259185dba016135ae2a31"}},"memorySize":256,"packageType":"Image","role":{"Fn::GetAtt":["CertHandlerLambdaServiceRoleA08797B0","Arn"]},"tags":[{"key":"Environment","value":"Development"},{"key":"Project","value":"NFCVisitManagement"}],"timeout":30}}}}},"CertCustomResourceProvider":{"id":"CertCustomResourceProvider","path":"IoTCoreStack/CertCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.Provider","version":"2.202.0"},"children":{"framework-onEvent":{"id":"framework-onEvent","path":"IoTCoreStack/CertCustomResourceProvider/framework-onEvent","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.202.0","metadata":[{"code":"*","description":"*","runtime":"*","handler":"*","timeout":"*","logGroup":"*","vpc":"*","vpcSubnets":"*","securityGroups":"*","role":"*","functionName":"*","environmentEncryption":"*"},{"addEnvironment":["*","*"]}]},"children":{"ServiceRole":{"id":"ServiceRole","path":"IoTCoreStack/CertCustomResourceProvider/framework-onEvent/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.202.0","metadata":[{"assumedBy":{"principalAccount":"*","assumeRoleAction":"*"},"managedPolicies":[{"managedPolicyArn":"*"}]},{"addToPrincipalPolicy":[{}]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]},{"addToPrincipalPolicy":[{}]}]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"IoTCoreStack/CertCustomResourceProvider/framework-onEvent/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.202.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"IoTCoreStack/CertCustomResourceProvider/framework-onEvent/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}],"tags":[{"key":"Environment","value":"Development"},{"key":"Project","value":"NFCVisitManagement"}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"IoTCoreStack/CertCustomResourceProvider/framework-onEvent/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.202.0","metadata":["*",{"attachToRole":["*"]},{"attachToRole":["*"]},{"addStatements":[{}]},{"addStatements":[{}]}]},"children":{"Resource":{"id":"Resource","path":"IoTCoreStack/CertCustomResourceProvider/framework-onEvent/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["CertHandlerLambdaC1626125","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["CertHandlerLambdaC1626125","Arn"]},":*"]]}]},{"Action":"lambda:GetFunction","Effect":"Allow","Resource":{"Fn::GetAtt":["CertHandlerLambdaC1626125","Arn"]}}],"Version":"2012-10-17"},"policyName":"CertCustomResourceProviderframeworkonEventServiceRoleDefaultPolicy535D66D6","roles":[{"Ref":"CertCustomResourceProviderframeworkonEventServiceRoleD598489B"}]}}}}}}},"Code":{"id":"Code","path":"IoTCoreStack/CertCustomResourceProvider/framework-onEvent/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.202.0"},"children":{"Stage":{"id":"Stage","path":"IoTCoreStack/CertCustomResourceProvider/framework-onEvent/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.202.0"}},"AssetBucket":{"id":"AssetBucket","path":"IoTCoreStack/CertCustomResourceProvider/framework-onEvent/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.202.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"IoTCoreStack/CertCustomResourceProvider/framework-onEvent/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-514760581321-ap-northeast-1","s3Key":"bdc104ed9cab1b5b6421713c8155f0b753380595356f710400609664d3635eca.zip"},"description":"AWS CDK resource provider framework - onEvent (IoTCoreStack/CertCustomResourceProvider)","environment":{"variables":{"USER_ON_EVENT_FUNCTION_ARN":{"Fn::GetAtt":["CertHandlerLambdaC1626125","Arn"]}}},"handler":"framework.onEvent","role":{"Fn::GetAtt":["CertCustomResourceProviderframeworkonEventServiceRoleD598489B","Arn"]},"runtime":"nodejs22.x","tags":[{"key":"Environment","value":"Development"},{"key":"Project","value":"NFCVisitManagement"}],"timeout":900}}}}}}},"NFCThing-booth-1":{"id":"NFCThing-booth-1","path":"IoTCoreStack/NFCThing-booth-1","constructInfo":{"fqn":"aws-cdk-lib.aws_iot.CfnThing","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IoT::Thing","aws:cdk:cloudformation:props":{"attributePayload":{"attributes":{"boothId":"booth-1"}},"thingName":"booth-1"}}},"CustomCertResource-booth-1":{"id":"CustomCertResource-booth-1","path":"IoTCoreStack/CustomCertResource-booth-1","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.202.0","metadata":["*","*","*","*","*","*","*"]},"children":{"Default":{"id":"Default","path":"IoTCoreStack/CustomCertResource-booth-1/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.202.0"}}}},"PolicyAttachment-booth-1":{"id":"PolicyAttachment-booth-1","path":"IoTCoreStack/PolicyAttachment-booth-1","constructInfo":{"fqn":"aws-cdk-lib.aws_iot.CfnPolicyPrincipalAttachment","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IoT::PolicyPrincipalAttachment","aws:cdk:cloudformation:props":{"policyName":"NFCDevicePolicy","principal":{"Fn::GetAtt":["CustomCertResourcebooth1","CertificateArn"]}}}},"ThingAttachment-booth-1":{"id":"ThingAttachment-booth-1","path":"IoTCoreStack/ThingAttachment-booth-1","constructInfo":{"fqn":"aws-cdk-lib.aws_iot.CfnThingPrincipalAttachment","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IoT::ThingPrincipalAttachment","aws:cdk:cloudformation:props":{"principal":{"Fn::GetAtt":["CustomCertResourcebooth1","CertificateArn"]},"thingName":"booth-1"}}},"CustomCertArn-booth-1":{"id":"CustomCertArn-booth-1","path":"IoTCoreStack/CustomCertArn-booth-1","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.202.0"}},"NFCThing-booth-2":{"id":"NFCThing-booth-2","path":"IoTCoreStack/NFCThing-booth-2","constructInfo":{"fqn":"aws-cdk-lib.aws_iot.CfnThing","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IoT::Thing","aws:cdk:cloudformation:props":{"attributePayload":{"attributes":{"boothId":"booth-2"}},"thingName":"booth-2"}}},"CustomCertResource-booth-2":{"id":"CustomCertResource-booth-2","path":"IoTCoreStack/CustomCertResource-booth-2","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.202.0","metadata":["*","*","*","*","*","*","*"]},"children":{"Default":{"id":"Default","path":"IoTCoreStack/CustomCertResource-booth-2/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.202.0"}}}},"PolicyAttachment-booth-2":{"id":"PolicyAttachment-booth-2","path":"IoTCoreStack/PolicyAttachment-booth-2","constructInfo":{"fqn":"aws-cdk-lib.aws_iot.CfnPolicyPrincipalAttachment","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IoT::PolicyPrincipalAttachment","aws:cdk:cloudformation:props":{"policyName":"NFCDevicePolicy","principal":{"Fn::GetAtt":["CustomCertResourcebooth2","CertificateArn"]}}}},"ThingAttachment-booth-2":{"id":"ThingAttachment-booth-2","path":"IoTCoreStack/ThingAttachment-booth-2","constructInfo":{"fqn":"aws-cdk-lib.aws_iot.CfnThingPrincipalAttachment","version":"2.202.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IoT::ThingPrincipalAttachment","aws:cdk:cloudformation:props":{"principal":{"Fn::GetAtt":["CustomCertResourcebooth2","CertificateArn"]},"thingName":"booth-2"}}},"CustomCertArn-booth-2":{"id":"CustomCertArn-booth-2","path":"IoTCoreStack/CustomCertArn-booth-2","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.202.0"}},"IoTThingName-booth-1":{"id":"IoTThingName-booth-1","path":"IoTCoreStack/IoTThingName-booth-1","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.202.0"}},"IoTThingName-booth-2":{"id":"IoTThingName-booth-2","path":"IoTCoreStack/IoTThingName-booth-2","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.202.0"}},"IoTPolicyName":{"id":"IoTPolicyName","path":"IoTCoreStack/IoTPolicyName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.202.0"}},"DynamoDBTableName":{"id":"DynamoDBTableName","path":"IoTCoreStack/DynamoDBTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.202.0"}},"IoTEndpoint":{"id":"IoTEndpoint","path":"IoTCoreStack/IoTEndpoint","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.202.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"IoTCoreStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"IoTCoreStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.202.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"IoTCoreStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.202.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"IoTCoreStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.202.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}