{"version":"tree-0.1","tree":{"id":"App","path":"","children":{"CdkStack":{"id":"CdkStack","path":"CdkStack","children":{"CdkQueue":{"id":"CdkQueue","path":"CdkStack/CdkQueue","children":{"Resource":{"id":"Resource","path":"CdkStack/CdkQueue/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"visibilityTimeout":300}},"constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.196.0"}},"Policy":{"id":"Policy","path":"CdkStack/CdkQueue/Policy","children":{"Resource":{"id":"Resource","path":"CdkStack/CdkQueue/Policy/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::QueuePolicy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"sqs:SendMessage","Condition":{"ArnEquals":{"aws:SourceArn":{"Ref":"CdkTopic7E7E1214"}}},"Effect":"Allow","Principal":{"Service":"sns.amazonaws.com"},"Resource":{"Fn::GetAtt":["CdkQueueBA7F247D","Arn"]}}],"Version":"2012-10-17"},"queues":[{"Ref":"CdkQueueBA7F247D"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueuePolicy","version":"2.196.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.QueuePolicy","version":"2.196.0","metadata":[{"queues":["*"]}]}},"CdkStackCdkTopic7868E982":{"id":"CdkStackCdkTopic7868E982","path":"CdkStack/CdkQueue/CdkStackCdkTopic7868E982","children":{"Resource":{"id":"Resource","path":"CdkStack/CdkQueue/CdkStackCdkTopic7868E982/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Subscription","aws:cdk:cloudformation:props":{"endpoint":{"Fn::GetAtt":["CdkQueueBA7F247D","Arn"]},"protocol":"sqs","topicArn":{"Ref":"CdkTopic7E7E1214"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnSubscription","version":"2.196.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Subscription","version":"2.196.0","metadata":[{"topic":"*","endpoint":"*","protocol":"sqs","rawMessageDelivery":"*","filterPolicy":"*","filterPolicyWithMessageBody":"*","region":"*","deadLetterQueue":"*"}]}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.196.0","metadata":[{"visibilityTimeout":"*"}]}},"CdkTopic":{"id":"CdkTopic","path":"CdkStack/CdkTopic","children":{"Resource":{"id":"Resource","path":"CdkStack/CdkTopic/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Topic","aws:cdk:cloudformation:props":{}},"constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopic","version":"2.196.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Topic","version":"2.196.0","metadata":["*"]}},"CDKMetadata":{"id":"CDKMetadata","path":"CdkStack/CDKMetadata","children":{"Default":{"id":"Default","path":"CdkStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.196.0"}},"Condition":{"id":"Condition","path":"CdkStack/CDKMetadata/Condition","constructInfo":{"fqn":"aws-cdk-lib.CfnCondition","version":"2.196.0"}}},"constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}},"BootstrapVersion":{"id":"BootstrapVersion","path":"CdkStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.196.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"CdkStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.196.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.196.0"}},"IoTCoreStack":{"id":"IoTCoreStack","path":"IoTCoreStack","children":{"EventDataTable":{"id":"EventDataTable","path":"IoTCoreStack/EventDataTable","children":{"Resource":{"id":"Resource","path":"IoTCoreStack/EventDataTable/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"partitionKey","attributeType":"S"},{"attributeName":"sortKey","attributeType":"S"},{"attributeName":"GSI_1_PK","attributeType":"S"},{"attributeName":"GSI_1_SK","attributeType":"S"},{"attributeName":"GSI_2_PK","attributeType":"S"},{"attributeName":"GSI_2_SK","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","globalSecondaryIndexes":[{"indexName":"GSI1-GenericQueries","keySchema":[{"attributeName":"GSI_1_PK","keyType":"HASH"},{"attributeName":"GSI_1_SK","keyType":"RANGE"}],"projection":{"projectionType":"ALL"}},{"indexName":"VisitRecordsByDateAndTimestamp","keySchema":[{"attributeName":"GSI_2_PK","keyType":"HASH"},{"attributeName":"GSI_2_SK","keyType":"RANGE"}],"projection":{"projectionType":"ALL"}}],"keySchema":[{"attributeName":"partitionKey","keyType":"HASH"},{"attributeName":"sortKey","keyType":"RANGE"}],"tableName":"EventData","tags":[{"key":"Environment","value":"Development"},{"key":"Project","value":"NFCVisitManagement"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.196.0"}},"ScalingRole":{"id":"ScalingRole","path":"IoTCoreStack/EventDataTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.196.0","metadata":["*"]}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.196.0","metadata":[{"tableName":"*","partitionKey":{"name":"*","type":"S"},"sortKey":{"name":"*","type":"S"},"billingMode":"PAY_PER_REQUEST","removalPolicy":"destroy"},{"addGlobalSecondaryIndex":[{"indexName":"*","partitionKey":{"name":"*","type":"S"},"projectionType":"ALL"}]},{"addGlobalSecondaryIndex":[{"indexName":"*","partitionKey":{"name":"*","type":"S"},"projectionType":"ALL"}]}]}},"NFCThing-booth-1":{"id":"NFCThing-booth-1","path":"IoTCoreStack/NFCThing-booth-1","attributes":{"aws:cdk:cloudformation:type":"AWS::IoT::Thing","aws:cdk:cloudformation:props":{"attributePayload":{"attributes":{"boothId":"booth-1"}},"thingName":"booth-1"}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iot.CfnThing","version":"2.196.0"}},"NFCThing-booth-2":{"id":"NFCThing-booth-2","path":"IoTCoreStack/NFCThing-booth-2","attributes":{"aws:cdk:cloudformation:type":"AWS::IoT::Thing","aws:cdk:cloudformation:props":{"attributePayload":{"attributes":{"boothId":"booth-2"}},"thingName":"booth-2"}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iot.CfnThing","version":"2.196.0"}},"NFCIoTPolicy":{"id":"NFCIoTPolicy","path":"IoTCoreStack/NFCIoTPolicy","attributes":{"aws:cdk:cloudformation:type":"AWS::IoT::Policy","aws:cdk:cloudformation:props":{"tags":[{"key":"Environment","value":"Development"},{"key":"Project","value":"NFCVisitManagement"}],"policyDocument":{"Version":"2012-10-17","Statement":[{"Effect":"Allow","Action":["iot:Connect"],"Resource":["arn:aws:iot:ap-northeast-1:514760581321:client/nfc-reader-*"]},{"Effect":"Allow","Action":["iot:Publish"],"Resource":["arn:aws:iot:ap-northeast-1:514760581321:topic/nfc/visits/*"]},{"Effect":"Allow","Action":["iot:Subscribe"],"Resource":["arn:aws:iot:ap-northeast-1:514760581321:topicfilter/nfc/commands/*"]},{"Effect":"Allow","Action":["iot:Receive"],"Resource":["arn:aws:iot:ap-northeast-1:514760581321:topic/nfc/commands/*"]}]},"policyName":"NFCDevicePolicy"}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iot.CfnPolicy","version":"2.196.0"}},"IoTRuleRole":{"id":"IoTRuleRole","path":"IoTCoreStack/IoTRuleRole","children":{"ImportIoTRuleRole":{"id":"ImportIoTRuleRole","path":"IoTCoreStack/IoTRuleRole/ImportIoTRuleRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.196.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"IoTCoreStack/IoTRuleRole/Resource","attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"iot.amazonaws.com"}}],"Version":"2012-10-17"},"policies":[{"policyName":"DynamoDBAccess","policyDocument":{"Statement":[{"Action":["dynamodb:GetItem","dynamodb:PutItem","dynamodb:Query","dynamodb:UpdateItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["EventDataTable8B81539D","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["EventDataTable8B81539D","Arn"]},"/index/*"]]}]}],"Version":"2012-10-17"}}],"tags":[{"key":"Environment","value":"Development"},{"key":"Project","value":"NFCVisitManagement"}]}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.196.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.196.0","metadata":[{"assumedBy":{"principalAccount":"*","assumeRoleAction":"*"},"inlinePolicies":"*"}]}},"VisitRule":{"id":"VisitRule","path":"IoTCoreStack/VisitRule","attributes":{"aws:cdk:cloudformation:type":"AWS::IoT::TopicRule","aws:cdk:cloudformation:props":{"ruleName":"ProcessNFCVisits","tags":[{"key":"Environment","value":"Development"},{"key":"Project","value":"NFCVisitManagement"}],"topicRulePayload":{"sql":"SELECT *, topic(3) as deviceId FROM 'nfc/visits/+'","description":"Process NFC visit data and store in DynamoDB","actions":[{"dynamoDb":{"tableName":{"Ref":"EventDataTable8B81539D"},"roleArn":{"Fn::GetAtt":["IoTRuleRole7CB25599","Arn"]},"hashKeyField":"PK","hashKeyValue":"BOOTHS#${boothId}","rangeKeyField":"SK","rangeKeyValue":"RECORD#${timestamp}"}}],"ruleDisabled":false}}},"constructInfo":{"fqn":"aws-cdk-lib.aws_iot.CfnTopicRule","version":"2.196.0"}},"IoTThingName-booth-1":{"id":"IoTThingName-booth-1","path":"IoTCoreStack/IoTThingName-booth-1","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.196.0"}},"IoTThingName-booth-2":{"id":"IoTThingName-booth-2","path":"IoTCoreStack/IoTThingName-booth-2","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.196.0"}},"IoTPolicyName":{"id":"IoTPolicyName","path":"IoTCoreStack/IoTPolicyName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.196.0"}},"DynamoDBTableName":{"id":"DynamoDBTableName","path":"IoTCoreStack/DynamoDBTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.196.0"}},"IoTEndpoint":{"id":"IoTEndpoint","path":"IoTCoreStack/IoTEndpoint","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.196.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"IoTCoreStack/CDKMetadata","children":{"Default":{"id":"Default","path":"IoTCoreStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.196.0"}}},"constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}},"BootstrapVersion":{"id":"BootstrapVersion","path":"IoTCoreStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.196.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"IoTCoreStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.196.0"}}},"constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.196.0"}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}},"constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.196.0"}}}